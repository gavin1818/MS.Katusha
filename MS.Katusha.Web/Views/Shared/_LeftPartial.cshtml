@using System.Collections.Specialized
@using MS.Katusha.Domain.Entities
@using Raven.Abstractions.Data

@if (Request.IsAuthenticated) {
    var profile = ViewBag.KatushaProfile as Profile;
    var user = ViewBag.KatushaUser as User;
    <ul>
        @if (profile != null) {
            
            <li>@Html.ActionLink("My messages", "MyMessages", "Profiles", new { pageNo = 1 }, null)</li>
            <li>@Html.ActionLink("My visitors", "Visitors", "Profiles", new { pageNo = 1 }, null)</li>
            <li>@Html.ActionLink("View my profile", "Show", "Profiles", new { key = Html.KeyFor(profile) }, null)</li>
            <li>@Html.ActionLink("Edit my profile", "Edit", "Profiles", new { key = Html.KeyFor(profile) }, null)</li>
            <li>@Html.ActionLink("My Photos", "Photos", "Profiles")</li>
            <li>@Html.ActionLink("Membership", "Membership", "Profiles")</li>
        } else {
            if (user != null && !user.EmailValidated) {
                  <li>Email not confirmed yet!<br />
                      If you haven't received a mail from us, you can @Html.ActionLink("resend the Confirmation Mail", "SendConfirmationMail", "Home") again.
                      </li>
            } else if (user != null && user.Gender == 0) {
                 <li>Create a new
                     <ul>
                         <li>@Html.ActionLink("Girl profile", "Create", "Profiles", new { key = "Girl" }, null)</li>
                         <li>@Html.ActionLink("Boy profile", "Create", "Profiles", new { key = "Boy" }, null)</li>
                     </ul>
                 </li>
            }
        }
    </ul>
}
<div class="search">
@if (ViewBag.KatushaSearch != null && ViewBag.KatushaSearch.Total >= 0) {
    var filters = ViewBag.KatushaSearch.Filters as NameValueCollection;
    var faceting = ViewBag.KatushaSearch.FacetValues as IDictionary<string, IEnumerable<FacetValue>>;
    <ul>
        @foreach (var key in filters.AllKeys) {
            <li>
                @key
                <ul>
                    @foreach (var value in filters.GetValues(key)) {
                        <li>
                            @Html._LText(key, value) <a class="removeFacet" href="remove f.Key">[X]</a>
                        </li>
                    }
                </ul>
            </li>
        }
    </ul>
    <hr />
    <ul>            
        @foreach (var f in faceting) {
            <li>
                @if (!(f.Key == "From" || f.Key == "City")) {
                    @Html._R(String.Format("Profile.{0}.DisplayName", f.Key))
                    <br />
                } else {
                    @f.Key
                }    
                <ul>
                    @foreach (var fv in f.Value) {
                        string value;
                        if (f.Key == "City") {
                            value = fv.Range;
                        } else {
                            string key;

                            if (f.Key == "From") {
                                key = "Country";
                            } else {
                                key = f.Key;
                            }
                            var lookupKey = Html._LText(key, Convert.ToByte(fv.Range));
                            value = Html._LText(key, lookupKey);
                        }

                        <li>
                            <a href="@Html.SetFacet(f.Key, fv.Range)">
                                @((String.IsNullOrWhiteSpace(value)) ? Html._R("NotFilled") : value)
                            </a> 
                            <span>(@fv.Count)</span>
                        </li>
                    }
                </ul>
               
            </li>
        }
    </ul>
}
</div>

<div>NEW GIRLS</div>
