@using MS.Katusha.Enumerations
@model MS.Katusha.Web.Models.NewVisitsModel
@{ ViewBag.Title = "New Visits"; }

<h2>New Visitors ( @Model.Visits.Count ) since @Model.LastVisitTime.ToLocalTime().</h2>

<div id="gallery" data-toggle="modal-gallery" data-target="#modal-gallery">
    @foreach (var visit in Model.Visits) {
        var profile = visit.VisitorProfile;
        var val = ((String.IsNullOrWhiteSpace(profile.FriendlyName)) ? profile.Guid.ToString() : profile.FriendlyName);
        var date = visit.LastVisitTime.ToLocalTime();
        var now = DateTimeOffset.UtcNow.ToLocalTime();
        var dateString = "";
        if (now.Day == date.Day && now.Month == date.Month && now.Year == date.Year) {
            dateString = date.DateTime.ToShortTimeString();
        } else {
            dateString = date.DateTime.ToShortDateString();
        }
        <div class="gallery-item" style="display: inline-block;" >
            <div class="bar">
                <a title="@(profile.Name + " - " + (DateTimeOffset.UtcNow.Year - profile.BirthYear).ToString() + " - " + Html._LText("Country", profile.From.ToString()))" href="/Profiles/Show/@(val)" rel="gallery">
                    @Html.Photo(profile.ProfilePhotoGuid, PhotoType.Thumbnail)
                </a>
                <div style="border: 1 solid">
                    @profile.Name<br/>
                    @(dateString)<br/>
                    @(visit.Count) Time(s)<br/><br/>
                </div>
            </div>
        </div>
    }
</div>

<div>
    @Html.ActionLink("View all visitors", "Index", "Visitor", null, null)
</div>
